/*!
*  Mt JS is small JavaScript RIA library
*  Licence MIT
*  Author: Mikhail Tatsky - JavaScript Arhitect
*  http://ru.linkedin.com/pub/mikhail-tatsky/4b/69a/804/
*  Connect with me if want to hire
*/
"use strict";var Mt={global:this,version:"0.0.2"};Mt.apply=function(c,b){for(var a in b){c[a]=b[a]}};Mt.applyIf=function(c,b){for(var a in b){if(c[a]===undefined){c[a]=b[a]}}};Mt.namespace=function(){var d=0,a=arguments.length;for(;d<a;d++){var f=arguments[d],g=f.split("."),c=1,b=g.length;Mt.global[g[0]]=Mt.global[g[0]]||{};var e=Mt.global[g[0]];for(;c<b;c++){e[g[c]]=e[g[c]]||{};e=e[g[c]]}}};Mt.ns=Mt.namespace;Mt.typeOf=function(b){if(b===null){return"null"}var a=typeof b;if(a==="undefined"||a==="string"||a==="number"||a==="boolean"){return a}var c=Object.prototype.toString,d=c.call(b);switch(d){case"[object Array]":return"array";case"[object Date]":return"date";case"[object Boolean]":return"boolean";case"[object Number]":return"number";case"[object RegExp]":return"regexp"}if(a==="function"){return"function"}if(a==="object"){return"object"}};Mt.isArray=("isArray" in Array)?Array.isArray:function(a){var b=Object.prototype.toString;return b.call(a)==="[object Array]"};Mt.isObject=function(a){var b=Object.prototype.toString;return b.call(a)==="[object Object]"};Mt.isFunction=function(a){var b=Object.prototype.toString;return b.apply(a)==="[object Function]"};Mt.isString=function(a){return typeof a==="string"};Mt.isBoolean=function(a){return typeof a==="boolean"};Mt.each=function(g,f){var c=g,e=Mt.typeOf(g);switch(e){case"array":var d=0,b=c.length;for(;d<b;d++){f(g[d],d,g)}break;case"object":var h;for(h in g){f(g[h],h,g)}break}};Mt.trait=function(f,m){if(m.classes){var e=0,c=m.classes,a=c.length;if(Mt.typeOf(m.classes[0])==="object"){for(;e<a;e++){var n=c[e],g=n._class,b=n.methods,d=0,l=b.length;for(;d<l;d++){var k=b[d];f[k]=g.prototype[k]}}}else{for(;e<a;e++){Mt.apply(f,c[e]["prototype"])}}}if(m.methods){var e=0,b=m.methods,a=b.length,h;for(;e<a;e++){h=b[e];f[h.name]=h.method}}};Mt.applyConfig=function(b,a){var c,a=a||{};if(b._isConfigApplied===true){return b}for(c in a){b[c]=a[c]}b._isConfigApplied=true;return b};Mt.apply(Mt,{prefix:"mt-gen",idSeed:0,id:function(a,b){if(!a){return(b||Mt.prefix)+(++Mt.idSeed)}a=a.dom||{};if(!a.id){a.id=(b||Mt.prefix)+(++Mt.idSeed)}return a.id}});Mt.Collection=function(a){var d=this;d.items=[];d.keys=[];d.map={};d.indexMap={};d.length=0;if(a){if(a.length>0){var c=0,b=a.length;for(;c<b;c++){d.add(c,a[c])}}else{for(var e in a){d.add(e,a[e])}}}};Mt.Collection.prototype={add:function(a,c){var b=this;b.items.push(c);b.keys.push(a);b.map[a]=c;b.indexMap[a]=b.length;b.length++},remove:function(b){var c=this,a=c.indexMap[b];c.items.splice(a,1);c.keys.splice(a,1);delete c.indexMap[a];delete c.map[b];c.length--},removeAll:function(){var a=this;a.items=[];a.keys=[];a.indexMap={};a.map={};a.length=0},get:function(a){var b=this;return b.map[a]},each:function(c){var d=this,b=0,a=d.length;for(;b<a;b++){c(d.keys[b],d.items[b],b,d.length)}}};(function(){var c={},b={};var d=function(f,e){for(var g in e.prototype){if(f.prototype[g]===undefined){f.prototype[g]=e.prototype[g]}}};var a=function(){};a.prototype={items:new Mt.Collection(),add:function(g,j){var k=g.split("."),f=1,e=k.length-1;Mt.ns(g);var h=Mt.global[k[0]];for(;f<e;f++){h=h[k[f]]}if(k.length>1){h[k[k.length-1]]=j}else{Mt.global[k[0]]=j}this.items.add(g,j)},get:function(e){return this.items.get(e)}};Mt.ClassManager=new a();Mt.Class=function(g,f){var f=f||{},k=[];if(Mt.isArray(g)){k=g;g=k[0]}if(f.constructor===Object){if(f.extend===undefined){f.constructor=function(){}}else{f.constructor=function(){this.Super("constructor",arguments)}}}if(f.extend===undefined){c[g]=f.constructor}else{c[g]=f.constructor;var e;switch(typeof f.extend){case"string":e=Mt.ClassManager.get(f.extend);c[g].prototype.$Super=Mt.ClassManager.get(f.extend);break;case"function":e=f.extend;c[g].prototype.$Super=f.extend;break}delete f.extend;c[g].prototype.Super=function(n,l){var m=this;if(m.$Iam){m.$Iam=Mt.ClassManager.get(m.$Iam.prototype.$Super.prototype.$name)}else{m.$Iam=Mt.ClassManager.get(m.$Super.prototype.$name)}switch(n){case"const":case"constructor":m.$Iam.apply(m,l);break;default:m.$Iam.prototype[n].apply(m,l)}delete m.$Iam};d(c[g],e)}c[g].prototype.$name=g;if(f.traits){Mt.trait(c[g].prototype,f.traits);delete c[g].prototype.traits}if(f.plugins!==undefined){if(c[g].prototype.$plugins===undefined){c[g].prototype.$plugins=[]}c[g].prototype.$plugins=c[g].prototype.$plugins.concat(f.plugins);delete c[g].prototype.plugins}for(var j in f){c[g].prototype[j]=f[j]}var h=c[g];if(f.singleton===true){delete c[g];h=new h(f);c[g]=h}if(k.length>1){Mt.each(k,function(l){Mt.ClassManager.add(l,h)})}else{Mt.ClassManager.add(g,h)}if(f.type){b[f.type]=h;Mt.addWidgetType(f.type,h)}else{if(f.ptype){b[f.type]=h;Mt.addPluginByType(f.ptype,h)}}};Mt.getClassByType=function(e){return b[e]}})();Mt.Class("Mt.Data",{constructor:function(d){var c=this;c.map={};if(d){var a=0,b=d.length,e=c.map;for(;a<b;a++){e[a]=d[a]}}c.length=0},add:function(a,c){var b=this;b.map[a]=c;b.length++},get:function(a){return this.map[a]}});Mt.Class("Mt.PluginManager",{singleton:true,constructor:function(){var a=this;a.ptypes=new Mt.Data()},addPlugin:function(b,a){this.ptypes.add(b,a)},getPlugin:function(a){return this.ptypes.get(a)}});Mt.addPluginByType=function(b,a){Mt.PluginManager.addPlugin(b,a)};Mt.getPluginByType=function(a){return Mt.PluginManager.getPlugin(a)};Mt.Class("Mt.WidgetManager",{singleton:true,constructor:function(){var a=this;a.wtypes=new Mt.Data();a.widgets=new Mt.Data()},addWidgetType:function(a,b){b.prototype.wtype=a;this.wtypes.add(a,b)},getWidgetClassByType:function(a){return this.wtypes.get(a)},addWidget:function(b,a){this.widgets.add(b,a)},getWidget:function(a){return this.widgets.get(a)}});Mt.addWidgetType=function(a,b){Mt.WidgetManager.addWidgetType(a,b)};Mt.getWidgetClassByType=function(a){return Mt.WidgetManager.getWidgetClassByType(a)};Mt.addWidget=function(b,a){Mt.WidgetManager.addWidget(b,a)};Mt.getWidget=function(a){return Mt.WidgetManager.getWidget(a)};(function(){var b=0,a={};Mt.Class(["Mt.Event","Mt.Observable"],{traits:{classes:[Mt.TraitClass]},constructor:function(e){var j=this,e=e||{};Mt.applyConfig(j,e);j.$events={};if(j.listeners||j.events){var k=j.listeners||j.events,g=0,d=k.length;for(;g<d;g++){var n=k[g],h=null,m=null,l=null,f=[];for(var c in n){if(c==="scope"){l=n[c]}else{if(c==="params"){f=n[c]}else{h=c;m=n[c]}}}if(h===null||Mt.isFunction(m)===false){throw new Error("Event was not set")}if(Mt.isArray(f)===false){throw new Error("params must be array")}j.addEvent(h);j.on(h,m,l,f)}}},on:function(c,e,d,f){if(this.$events[c]===undefined){console.log(arguments);throw new Error("Event name is not set: "+c)}e.$mtFnSeed=b;a[b]=e;b++;this.$events[c].push({fn:e,scope:d,params:f||[]})},un:function(d,g){var h=this,j=h.$events[d];if(!j){return false}var f=0,c=j.length;for(;f<c;f++){var e=j[f];if(e.fn.$mtFnSeed===g.$mtFnSeed){e.toRemove=true;return true}}return false},once:function(c,e,d){var g=this,f=function(){e.apply(this,arguments);g.un(c,f)};g.on(c,f,d)},unAll:function(){this.$events={}},unAllByType:function(c){this.$events[c]=[]},fire:function(e){var j=this,k=j.$events[e];if(!k){return false}var h=1,d=arguments.length,g=[j];for(;h<d;h++){g.push(arguments[h])}var h=0,d=k.length;for(;h<d;h++){var f=k[h],c=[];if(f.toRemove===true){k.splice(h,1);h--;d=k.length;continue}c=c.concat(g);if(f.params){c=c.concat(f.params)}f.fn.apply(f.scope||j,c)}},addEvent:function(c){var d=this;d.$events[c]=d.$events[c]||[]},addEvents:function(e){var g=this;if(arguments.length>1){var d=[],f=0,c=arguments.length;for(;f<c;f++){d[f]=arguments[f]}e=d}if(Mt.typeOf(e)==="string"){g.$events[e]=g.$events[e]||[]}else{if(Mt.typeOf(e)==="array"){var f=0,c=e.length;for(;f<c;f++){g.$events[e[f]]=g.$events[e[f]]||[]}}}},has:function(c){var d=this.$events[c];if(!d){return false}return d.length!==0}})})();Mt.$=$;Mt.get=function(b){var a=Mt.typeOf(b);switch(a){case"string":return new Mt.Element(Mt.$("#"+b)[0]);break;default:return new Mt.Element(b);break}};Mt.Element=function(b){var a=this;a.dom=b;a.$dom=Mt.$(b)};Mt.Element.prototype={on:function(a,c,b){var d=this;if(b){d.$dom.bind(a,$.proxy(c,b))}else{d.$dom.bind(a,c)}},un:function(){},getByClass:function(a){return this.dom.getElementsByClassName(a)[0]}};Mt.onReady=function(a){$(document).ready(a)};Mt.Class("Mt.Model",{constructor:function(e){var d=this;if(Mt.isArray(e)){var g={},a=d.fields,c=0,b=a.length;for(;c<b;c++){var f=a[c];g[f]=e[c]}d.data=g}else{if(d.fields===undefined){var a=[];for(var f in e){a.push(f)}d.fields=a}var g={},a=d.fields,c=0,b=a.length;for(;c<b;c++){var f=a[c];g[f]=e[f]}d.data=g}},get:function(a){var b=this;return b.data[a]},set:function(a,c){var b=this;b.data[a]=c}});Mt.Class("Mt.Store",{extend:Mt.Event,constructor:function(a){var b=this,a=a||{};Mt.applyConfig(b,a);b.data=[];b.setModel();if(a.data){b.setData(a.data);delete a.data}b.Super("const",arguments);b.init()},init:function(){var a=this;a.initId();a.initPlugins()},setModel:function(){var b=this,a=b.model;if(!a===undefined){a=Mt.Model}else{a=Mt.ClassManager.get(b.model)}b.model=a;b.fields=a.prototype.fields;if(b.fields===undefined){throw new Error("needed to set fields in Model of Store")}},setData:function(e){var d=this,c=0,a=e.length,b=d.model;if(Mt.isObject(e[0])){for(;c<a;c++){d.data[c]=new b(e[c])}}else{for(;c<a;c++){d.data[c]=new b(e[c])}}}});Mt.Class("Mt.Widget",{extend:Mt.Event,constructor:function(a){var b=this;Mt.applyConfig(b,a);b.Super("const",arguments);b.init()},init:function(){var a=this;a.initId();a.addEvents("beforerender","afterrender","render","show","hide","destroy");a.initPlugins()},renderItems:function(f){var e=this,c=0,b=e.items.length;for(;c<b;c++){var d=e.items[c],a=Mt.getClassByType(d.type);d.renderTo=f;e.items[c]=new a(d)}}});Mt.Class("Mt.Button",{extend:Mt.Widget,constructor:function(){var a=this;a.Super("const",arguments)},init:function(){var a=this;a.addEvents("click","mousedown","mouseup","mouseover","mouseout");a.Super("init",arguments);a.render();a.setOns()},setOns:function(){var b=this,a=b.el;a.on("click",b.onClick,b);a.on("mousedown",b.onMouseDown,b);a.on("mouseup",b.onMouseUp,b);a.on("mouseover",b.onMouseOver,b);a.on("mouseout",b.onMouseOut,b)},cls:"mt mt-button",text:"",height:28,paddingTextWidth:5,render:function(){var c=this,d=c.renderTo||document.body,b=document.createElement("div"),a=0;c.fire("beforerender");if(c.width){a=c.width}else{a=c.paddingTextWidth*2;a+=c.text.length*7}b.className=c.cls;b.style.width=a+"px";b.style.height=c.height+"px";b.innerHTML=['<div class="mt-button-text">',c.text,"</div>"].join("");c.el=Mt.get(d.appendChild(b));c.fire("afterrender");c.fire("render")},onClick:function(){var a=this;a.fire("click")},onMouseDown:function(){var a=this;a.fire("mousedown")},onMouseUp:function(){var a=this;a.fire("mouseup")},onMouseOver:function(){var a=this;a.fire("mouseover")},onMouseOut:function(){var a=this;a.fire("mouseout")}});Mt.Class("Mt.Field",{extend:Mt.Widget,type:"field",constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("const",arguments)},init:function(){var a=this;a.addEvents();a.Super("init",arguments);a.render()},cls:"mt mt-field",value:"",width:100,emptyText:"",render:function(){var c=this,d=c.renderTo||document.body,b=document.createElement("div"),a=0;c.fire("beforerender");b.className=c.cls;b.innerHTML=['<div class="mt-field-label">',c.label+":","</div>",'<div class="mt-field-text">','<input placeholder="'+c.emptyText+'" type="text" class="mt-field-text-input" style="width: '+c.width+'px;" value="'+c.value+'">',"</div>"].join("");c.el=d.appendChild(b);c.fire("afterrender");c.fire("render")}});Mt.Class("Mt.Panel",{extend:Mt.Event,constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.init()},init:function(){var a=this;a.render()},cls:"mt mt-panel",value:"",width:300,height:200,title:"",frame:false,shadow:true,render:function(){var c=this,d=c.renderTo||document.body,b=document.createElement("div"),a=c.cls;if(c.shadow){a+=" mt-panel-shadow"}b.className=a;b.style.width=c.width+"px";b.style.height=c.height+"px";b.innerHTML=['<div class="mt-panel-header">','<div class="mt-panel-header-text">',c.title,"</div>","</div>",'<div style="height: '+(c.height-34)+"px;width: "+(c.width-2)+'px;" class="mt-panel-body ">',"</div>"].join("");c.el=d.appendChild(b)}});Mt.Class("Mt.TextArea",{extend:Mt.Widget,type:"textarea",constructor:function(){var a=this;a.Super("const",arguments)},init:function(){var a=this;a.addEvents();a.Super("init",arguments);a.render()},cls:"mt mt-textarea",value:"",width:250,height:100,emptyText:"",render:function(){var c=this,d=c.renderTo||document.body,b=document.createElement("div"),a=0;c.fire("beforerender");b.className=c.cls;b.innerHTML=['<div class="mt-textarea-label">',c.label+":","</div>",'<div class="mt-textarea-text">','<textarea autocomplete="off" placeholder="'+c.emptyText+'" type="text" class="mt-textarea-text-input" style="width: '+c.width+"px;height:"+c.height+'px;" value="'+c.value+'"></textarea>',"</div>"].join("");c.el=d.appendChild(b);c.fire("afterrender");c.fire("render")}});Mt.Class("Mt.Form",{extend:Mt.Widget,type:"form",constructor:function(){var a=this;a.Super("const",arguments)},init:function(){var a=this;a.addEvents();a.render()},cls:"mt mt-form",value:"",width:200,emptyText:"",render:function(){var c=this,d=c.renderTo||document.body,b=document.createElement("div"),a=c.cls;c.fire("beforerender");b.className=c.cls;b.style.width=c.width+"px";b.style.height=c.height+"px";b.innerHTML=['<div class="mt-form-body">',"</div>"].join("");c.el=Mt.get(d.appendChild(b));c.renderItems(c.el.getByClass("mt-form-body"));c.fire("afterrender");c.fire("render")}});Mt.Class("Mt.Grid",{extend:Mt.Event,width:200,height:200,cls:"mt mt-grid",cellWidth:70,cellHeight:32,header:true,constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.addEvent("afterrender");b.init()},init:function(){var a=this;a.render();a.initElements();a.fireEvent("afterrender")},initElements:function(){var a=this;if(a.header!==false){a.header=new Mt.grid.Header({widget:a});a.leftSideHeader=new Mt.grid.Header({widget:a,left:true})}a.body=new Mt.grid.Body({widget:a});a.leftBody=new Mt.grid.Body({widget:a,left:true})},render:function(){var b=this,c=b.renderTo||document.body,a=document.createElement("div");a.className=b.cls;a.style.width=b.width+"px";a.style.height=b.height+"px";a.innerHTML=['<div class="mt-grid-left-side"></div>','<div class="mt-grid-right-side">',"</div>"].join("");b.el=c.appendChild(a)},update:function(){var a=this;a.checkRows();a.updateRows()},checkRows:function(){var h=this,a=h.el,m=h.store,e=m.data,b=h.columns,o=a.getElementsByTagName("tbody")[0],f=o.childNodes.length-1,l=e.length-f,d=0;for(;d<l;d++){var n="",g=document.createElement("tr"),c=0,k=b.length;for(;c<k;c++){n+=['<td style="max-width: 70px;" class="mt-grid-body-td">','<div class="mt-grid-body-td-text">',"</div>","</td>"].join("")}g.innerHTML=n;o.appendChild(g)}},updateRows:function(){var k=this,a=k.el,m=k.store,e=m.data,c=k.columns;tbodyEl=a.getElementsByTagName("tbody")[0],i=1,iL=e.length+1;for(;i<iL;i++){var h=tbodyEl.childNodes[i],n=e[i-1].data,d=0,l=c.length;for(;d<l;d++){var b=h.childNodes[d],f=b.firstChild,g=c[d].index;f.innerHTML=n[g]}}}});Mt.Class("Mt.grid.Body",{extend:Mt.Event,constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.init()},init:function(){var a=this;a.render();a.setHandlers()},setHandlers:function(){var b=this,a=b.widget;a.on("afterrender",b.onAfterRender,b)},render:function(){var h=this,j=h.widget,g=j.el.getElementsByClassName(h.left?"mt-grid-left-side":"mt-grid-right-side")[0],a=document.createElement("div"),b="",e=j.columns,f=0,c=e.length;b+="<tr>";for(;f<c;f++){var d=e[f];if((!h.left&&!d.locked)||(h.left&&d.locked===true)){b+='<th style="width: 60px;"></th>'}}b+="</tr>";a.className="mt-grid-body";a.innerHTML=['<table style="">','<tbody class="mt-grid-body">',b,"</tbody>","</table>"].join("");h.el=g.appendChild(a)},onAfterRender:function(){var a=this;a.update()},update:function(){var a=this;a.checkRows();a.updateRows()},checkRows:function(){var k=this,o=k.widget,a=k.el,n=o.store,f=n.data,c=o.columns,q=a.getElementsByTagName("tbody")[0],g=q.childNodes.length-1,m=f.length-g,e=0;for(;e<m;e++){var p="",h=document.createElement("tr"),d=0,l=c.length;h.className=(e%2===0)?"mt-grid-row-odd":"mt-grid-row-even";for(;d<l;d++){var b=c[d];if((!k.left&&!b.locked)||(k.left&&b.locked===true)){p+=['<td style="max-width: 60px;" class="mt-grid-body-td">','<div class="mt-grid-body-td-text">',"</div>","</td>"].join("")}}h.innerHTML=p;q.appendChild(h)}},updateRows:function(){var l=this,o=l.widget,a=l.el,n=o.store,f=n.data,d=o.columns;tbodyEl=a.getElementsByTagName("tbody")[0],i=1,iL=f.length+1;for(;i<iL;i++){var k=tbodyEl.childNodes[i],q=f[i-1].data,e=0,m=d.length,p=0;for(;e<m;e++){var c=d[e];if((!l.left&&!c.locked)){var b=k.childNodes[e-p],g=b.firstChild,h=c.index;g.innerHTML=q[h]}else{if(l.left&&c.locked===true){var b=k.childNodes[e-(e-p)],g=b.firstChild,h=c.index;g.innerHTML=q[h]}}if(c.locked){p++}}}}});Mt.Class("Mt.grid.Header",{extend:Mt.Event,constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.init()},init:function(){var a=this;a.render();a.setHandlers()},setHandlers:function(){var b=this,a=b.widget;a.on("afterrender",b.onAfterRender,b)},render:function(){var h=this,j=h.widget,d=j.columns,g=j.el.getElementsByClassName(h.left?"mt-grid-left-side":"mt-grid-right-side")[0],a=document.createElement("div"),f="",e=0,b=d.length;for(;e<b;e++){var c=d[e];if((!h.left&&!c.locked)||(h.left&&c.locked===true)){f+=['<div style="width:50px;" class="mt-grid-header-cell">','<div class="mt-grid-header-cell-text">',c.title,"</div>","</div>"].join("")}}a.className="mt-grid-header";a.innerHTML=f;h.el=g.appendChild(a)},onAfterRender:function(){var a=this}});