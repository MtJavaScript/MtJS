/*!
*  Mt JS is small JavaScript RIA library
*  Licence MIT
*  Author: Mikhail Tatsky - JavaScript Arhitect
*  http://ru.linkedin.com/pub/mikhail-tatsky/4b/69a/804/
*  Connect with me if want to hire
*/
"use strict";var Mt={global:this,version:"0.0.2"};Mt.apply=function(c,b){for(var a in b){c[a]=b[a]}};Mt.applyIf=function(c,b){for(var a in b){if(c[a]===undefined){c[a]=b[a]}}};Mt.namespace=function(){var d=0,a=arguments.length;for(;d<a;d++){var f=arguments[d],g=f.split("."),c=1,b=g.length;Mt.global[g[0]]=Mt.global[g[0]]||{};var e=Mt.global[g[0]];for(;c<b;c++){e[g[c]]=e[g[c]]||{};e=e[g[c]]}}};Mt.ns=Mt.namespace;Mt.typeOf=function(b){if(b===null){return"null"}var a=typeof b;if(a==="undefined"||a==="string"||a==="number"||a==="boolean"){return a}var c=Object.prototype.toString,d=c.call(b);switch(d){case"[object Array]":return"array";case"[object Date]":return"date";case"[object Boolean]":return"boolean";case"[object Number]":return"number";case"[object RegExp]":return"regexp"}if(a==="function"){return"function"}if(a==="object"){return"object"}};Mt.isArray=("isArray" in Array)?Array.isArray:function(a){var b=Object.prototype.toString;return b.call(a)==="[object Array]"};Mt.isObject=function(a){var b=Object.prototype.toString;return b.call(a)==="[object Object]"};Mt.isFunction=function(a){var b=Object.prototype.toString;return b.apply(a)==="[object Function]"};Mt.isString=function(a){return typeof a==="string"};Mt.isBoolean=function(a){return typeof a==="boolean"};Mt.each=function(g,f){var c=g,e=Mt.typeOf(g);switch(e){case"array":var d=0,b=c.length;for(;d<b;d++){f(g[d],d,g)}break;case"object":var h;for(h in g){f(g[h],h,g)}break}};Mt.trait=function(f,m){if(m.classes){var e=0,c=m.classes,a=c.length;if(Mt.typeOf(m.classes[0])==="object"){for(;e<a;e++){var n=c[e],g=n._class,b=n.methods,d=0,l=b.length;for(;d<l;d++){var k=b[d];f[k]=g.prototype[k]}}}else{for(;e<a;e++){Mt.apply(f,c[e]["prototype"])}}}if(m.methods){var e=0,b=m.methods,a=b.length,h;for(;e<a;e++){h=b[e];f[h.name]=h.method}}};Mt.applyConfig=function(b,a){var c,a=a||{};if(b._isConfigApplied===true){return b}for(c in a){b[c]=a[c]}b._isConfigApplied=true;return b};Mt.apply(Mt,{prefix:"mt-gen",idSeed:0,id:function(a,b){if(!a){return(b||Mt.prefix)+(++ZG.idSeed)}a=a.dom||{};if(!a.id){a.id=(b||Mt.prefix)+(++ZG.idSeed)}return a.id}});Mt.Collection=function(a){var d=this;d.items=[];d.keys=[];d.map={};d.indexMap={};d.length=0;if(a){if(a.length>0){var c=0,b=a.length;for(;c<b;c++){d.add(c,a[c])}}else{for(var e in a){d.add(e,a[e])}}}};Mt.Collection.prototype={add:function(a,c){var b=this;b.items.push(c);b.keys.push(a);b.map[a]=c;b.indexMap[a]=b.length;b.length++},remove:function(b){var c=this,a=c.indexMap[b];c.items.splice(a,1);c.keys.splice(a,1);delete c.indexMap[a];delete c.map[b];c.length--},removeAll:function(){var a=this;a.items=[];a.keys=[];a.indexMap={};a.map={};a.length=0},get:function(a){var b=this;return b.map[a]},each:function(c){var d=this,b=0,a=d.length;for(;b<a;b++){c(d.keys[b],d.items[b],b,d.length)}}};(function(){var c={},b={};var d=function(f,e){for(var g in e.prototype){if(f.prototype[g]===undefined){f.prototype[g]=e.prototype[g]}}};var a=function(){};a.prototype={items:new Mt.Collection(),add:function(g,j){var k=g.split("."),f=1,e=k.length-1;Mt.ns(g);var h=Mt.global[k[0]];for(;f<e;f++){h=h[k[f]]}if(k.length>1){h[k[k.length-1]]=j}else{Mt.global[k[0]]=j}this.items.add(g,j)},get:function(e){return this.items.get(e)}};Mt.ClassManager=new a();Mt.Class=function(g,f){var f=f||{},k=[];if(Mt.isArray(g)){k=g;g=k[0]}if(f.constructor===Object){if(f.extend===undefined){f.constructor=function(){}}else{f.constructor=function(){this.Super("constructor",arguments)}}}if(f.extend===undefined){c[g]=f.constructor}else{c[g]=f.constructor;var e;switch(typeof f.extend){case"string":e=Mt.ClassManager.get(f.extend);c[g].prototype.$Super=Mt.ClassManager.get(f.extend);break;case"function":e=f.extend;c[g].prototype.$Super=f.extend;break}delete f.extend;c[g].prototype.Super=function(n,l){var m=this;if(m.$Iam){m.$Iam=Mt.ClassManager.get(m.$Iam.prototype.$Super.prototype.$name)}else{m.$Iam=Mt.ClassManager.get(m.$Super.prototype.$name)}switch(n){case"const":case"constructor":m.$Iam.apply(m,l);break;default:m.$Iam.prototype[n].apply(m,l)}delete m.$Iam};d(c[g],e)}c[g].prototype.$name=g;if(f.traits){Mt.trait(c[g].prototype,f.traits);delete c[g].prototype.traits}if(f.plugins!==undefined){if(c[g].prototype.$plugins===undefined){c[g].prototype.$plugins=[]}c[g].prototype.$plugins=c[g].prototype.$plugins.concat(f.plugins);delete c[g].prototype.plugins}for(var j in f){c[g].prototype[j]=f[j]}var h=c[g];if(f.singleton===true){delete c[g];h=new h(f);c[g]=h}if(k.length>1){Mt.each(k,function(l){Mt.ClassManager.add(l,h)})}else{Mt.ClassManager.add(g,h)}if(f.type){b[f.type]=h;Mt.addWidgetType(f.type,h)}else{if(f.ptype){b[f.type]=h;Mt.addPluginByType(f.ptype,h)}}};Mt.getClassByType=function(e){return b[e]}})();Mt.Class("Mt.Data",{constructor:function(d){var c=this;c.map={};if(d){var a=0,b=d.length,e=c.map;for(;a<b;a++){e[a]=d[a]}}c.length=0},add:function(a,c){var b=this;b.map[a]=c;b.length++},get:function(a){return this.map[a]}});Mt.Class("Mt.PluginManager",{singleton:true,constructor:function(){var a=this;a.ptypes=new Mt.Data()},addPlugin:function(b,a){this.ptypes.add(b,a)},getPlugin:function(a){return this.ptypes.get(a)}});Mt.addPluginByType=function(b,a){Mt.PluginManager.addPlugin(b,a)};Mt.getPluginByType=function(a){return Mt.PluginManager.getPlugin(a)};Mt.Class("Mt.WidgetManager",{singleton:true,constructor:function(){var a=this;a.wtypes=new Mt.Data();a.widgets=new Mt.Data()},addWidgetType:function(a,b){b.prototype.wtype=a;this.wtypes.add(a,b)},getWidgetClassByType:function(a){return this.wtypes.get(a)},addWidget:function(b,a){this.widgets.add(b,a)},getWidget:function(a){return this.widgets.get(a)}});Mt.addWidgetType=function(a,b){Mt.WidgetManager.addWidgetType(a,b)};Mt.getWidgetClassByType=function(a){return Mt.WidgetManager.getWidgetClassByType(a)};Mt.addWidget=function(b,a){Mt.WidgetManager.addWidget(b,a)};Mt.getWidget=function(a){return Mt.WidgetManager.getWidget(a)};Mt.Class("Mt.Observable",{constructor:function(c){var g=this,c=c||{};Mt.applyConfig(g,c);g.events={};if(g.listeners){var h=g.listeners,e=0,b=h.length;for(;e<b;e++){var l=h[e],f=null,k=null,j=null,d=[];for(var a in l){if(a==="scope"){j=l[a]}else{if(a==="params"){d=l[a]}else{f=a;k=l[a]}}}if(f===null||Mt.isFunction(k)===false){throw new Error("Event was not set")}if(Mt.isArray(d)===false){throw new Error("params must be array")}g.addEvent(f);g.on(f,k,j,d)}}},on:function(a,c,b,d){if(this.events[a]===undefined){console.log(arguments);throw new Error("Event name is not set: "+a)}this.events[a].push({fn:c,scope:b,params:d||[]})},un:function(a,d){var f=this,g=f.events[a];if(!g){return false}var c=0,e=g.length;for(;c<e;c++){var b=g[c];if(b.fn===d){g.splice(c,1);return true}}return false},once:function(a,c,b){var e=this,d=function(){c.apply(this,arguments);e.un(a,d)};e.on(a,d,b)},unAll:function(){this.events={}},unAllByType:function(a){this.events[a]=[]},fireEvent:function(b){var g=this,h=g.events[b];if(!h){return false}var e=1,f=arguments.length,d=[g];for(;e<f;e++){d.push(arguments[e])}var e=0,f=h.length;for(;e<f;e++){var c=h[e],a=[];a=a.concat(d);if(c.params){a=a.concat(c.params)}c.fn.apply(c.scope||g,a)}},addEvent:function(a){var b=this;b.events[a]=b.events[a]||[]},addEvents:function(b){var e=this;if(arguments.length>1){var a=[],c=0,d=arguments.length;for(;c<d;c++){a[c]=arguments[c]}b=a}if(Mt.typeOf(b)==="string"){e.events[b]=e.events[b]||[]}else{if(Mt.typeOf(b)==="array"){var c=0,d=b.length;for(;c<d;c++){e.events[b[c]]=e.events[b[c]]||[]}}}},has:function(a){var b=this.events[a];if(!b){return false}return b.length!==0}});Mt.Class("Mt.TraitWidget",{initId:function(){var a=this,b=a.prefix||Mt.prefix;a.id=a.id||Mt.id(null,b);Mt.addWidget(a.id,a)},initPlugins:function(d){var j=this,e,k,f;if(j.plugins!==undefined){j.$plugins=j.plugins;delete j.plugins}var c=0,b=j.$plugins,a=b.length,h;for(;c<a;c++){f=b[c];f.widget=d;var g=f.type||f.ptype;e=Mt.getPluginByType(g);k=new e(f);h=f.inWidgetName||k.inWidgetName;if(h!==undefined){d[h]=k}}}});Mt.$=$;Mt.get=function(b){var a=Mt.typeOf(b);switch(a){case"string":return new Mt.Element(Mt.$("#"+b)[0]);break;default:return new Mt.Element(b);break}};Mt.Element=function(b){var a=this;a.dom=b;a.$dom=Mt.$(b)};Mt.Element.prototype={on:function(a,c,b){var d=this;if(b){d.$dom.bind(a,$.proxy(c,b))}else{d.$dom.bind(a,c)}},un:function(){},getByClass:function(a){return this.dom.getElementsByClassName(a)[0]}};Mt.onReady=function(a){$(document).ready(a)};Mt.Class("Mt.Model",{constructor:function(b){var a=this;a.data=b}});Mt.Class("Mt.Store",{extend:"Mt.Observable",constructor:function(a){var b=this,a=a||{};b.data=[];if(a.data){b.setData(a.data);delete a.data}Mt.apply(b,a);b.Super("constructor",arguments)},setData:function(d){var c=this,b=0,a=d.length;for(;b<a;b++){c.data[b]=new Mt.Model(d[b])}}});Mt.Class("Mt.Button",{extend:Mt.Observable,constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.init()},init:function(){var a=this;a.render();a.addEvents("click","mousedown","mouseup","mouseover","mouseout");a.setHandlers()},cls:"mt mt-button",text:"",height:28,paddingTextWidth:5,render:function(){var c=this,d=c.renderTo||document.body,b=document.createElement("div"),a=0;if(c.width){a=c.width}else{a=c.paddingTextWidth*2;a+=c.text.length*7}b.className=c.cls;b.style.width=a+"px";b.style.height=c.height+"px";b.innerHTML=['<div class="mt-button-text">',c.text,"</div>"].join("");c.el=Mt.get(d.appendChild(b))},setHandlers:function(){var b=this,a=b.el;a.on("click",b.onClick,b);a.on("mousedown",b.onMouseDown,b);a.on("mouseup",b.onMouseUp,b);a.on("mouseover",b.onMouseOver,b);a.on("mouseout",b.onMouseOut,b)},onClick:function(){var a=this;a.fireEvent("click")},onMouseDown:function(){var a=this;a.fireEvent("mousedown")},onMouseUp:function(){var a=this;a.fireEvent("mouseup")},onMouseOver:function(){var a=this;a.fireEvent("mouseover")},onMouseOut:function(){var a=this;a.fireEvent("mouseout")}});Mt.Class("Mt.Field",{extend:Mt.Observable,type:"field",constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.init()},init:function(){var a=this;a.render()},cls:"mt mt-field",value:"",width:100,emptyText:"",render:function(){var c=this,d=c.renderTo||document.body,b=document.createElement("div"),a=0;b.className=c.cls;b.innerHTML=['<div class="mt-field-label">',c.label+":","</div>",'<div class="mt-field-text">','<input placeholder="'+c.emptyText+'" type="text" class="mt-field-text-input" style="width: '+c.width+'px;" value="'+c.value+'">',"</div>"].join("");c.el=d.appendChild(b)}});Mt.Class("Mt.Panel",{extend:Mt.Observable,constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.init()},init:function(){var a=this;a.render()},cls:"mt mt-panel",value:"",width:300,height:200,title:"",frame:false,shadow:true,render:function(){var c=this,d=c.renderTo||document.body,b=document.createElement("div"),a=c.cls;if(c.shadow){a+=" mt-shadow"}b.className=a;b.style.width=c.width+"px";b.style.height=c.height+"px";b.innerHTML=['<div class="mt-panel-header">','<div class="mt-panel-header-text">',c.title,"</div>","</div>",'<div style="height: '+(c.height-34)+"px;width: "+(c.width-2)+'px;" class="mt-panel-body ">',"</div>"].join("");c.el=d.appendChild(b)}});Mt.Class("Mt.TextArea",{extend:Mt.Observable,type:"textarea",constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.init()},init:function(){var a=this;a.render()},cls:"mt mt-textarea",value:"",width:250,height:100,emptyText:"",render:function(){var c=this,d=c.renderTo||document.body,b=document.createElement("div"),a=0;b.className=c.cls;b.innerHTML=['<div class="mt-textarea-label">',c.label+":","</div>",'<div class="mt-textarea-text">','<textarea autocomplete="off" placeholder="'+c.emptyText+'" type="text" class="mt-textarea-text-input" style="width: '+c.width+"px;height:"+c.height+'px;" value="'+c.value+'"></textarea>',"</div>"].join("");c.el=d.appendChild(b)}});Mt.Class("Mt.Grid",{extend:"Mt.Observable",width:200,height:200,cls:"mt mt-grid",cellWidth:70,cellHeight:32,header:true,constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.addEvent("afterrender");b.init()},init:function(){var a=this;a.render();a.initElements();a.fireEvent("afterrender")},initElements:function(){var a=this;if(a.header!==false){a.header=new Mt.grid.Header({widget:a});a.leftSideHeader=new Mt.grid.Header({widget:a,left:true})}a.body=new Mt.grid.Body({widget:a});a.leftBody=new Mt.grid.Body({widget:a,left:true})},render:function(){var b=this,c=b.renderTo||document.body,a=document.createElement("div");a.className=b.cls;a.style.width=b.width+"px";a.style.height=b.height+"px";a.innerHTML=['<div class="mt-grid-left-side"></div>','<div class="mt-grid-right-side">',"</div>"].join("");b.el=c.appendChild(a)},update:function(){var a=this;a.checkRows();a.updateRows()},checkRows:function(){var h=this,a=h.el,m=h.store,e=m.data,b=h.columns,o=a.getElementsByTagName("tbody")[0],f=o.childNodes.length-1,l=e.length-f,d=0;for(;d<l;d++){var n="",g=document.createElement("tr"),c=0,k=b.length;for(;c<k;c++){n+=['<td style="max-width: 70px;" class="mt-grid-body-td">','<div class="mt-grid-body-td-text">',"</div>","</td>"].join("")}g.innerHTML=n;o.appendChild(g)}},updateRows:function(){var k=this,a=k.el,m=k.store,e=m.data,c=k.columns;tbodyEl=a.getElementsByTagName("tbody")[0],i=1,iL=e.length+1;for(;i<iL;i++){var h=tbodyEl.childNodes[i],n=e[i-1].data,d=0,l=c.length;for(;d<l;d++){var b=h.childNodes[d],f=b.firstChild,g=c[d].index;f.innerHTML=n[g]}}}});Mt.Class("Mt.grid.Body",{extend:Mt.Observable,constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.init()},init:function(){var a=this;a.render();a.setHandlers()},setHandlers:function(){var b=this,a=b.widget;a.on("afterrender",b.onAfterRender,b)},render:function(){var h=this,j=h.widget,g=j.el.getElementsByClassName(h.left?"mt-grid-left-side":"mt-grid-right-side")[0],a=document.createElement("div"),b="",e=j.columns,f=0,c=e.length;b+="<tr>";for(;f<c;f++){var d=e[f];if((!h.left&&!d.locked)||(h.left&&d.locked===true)){b+='<th style="width: 60px;"></th>'}}b+="</tr>";a.className="mt-grid-body";a.innerHTML=['<table style="">','<tbody class="mt-grid-body">',b,"</tbody>","</table>"].join("");h.el=g.appendChild(a)},onAfterRender:function(){var a=this;a.update()},update:function(){var a=this;a.checkRows();a.updateRows()},checkRows:function(){var k=this,o=k.widget,a=k.el,n=o.store,f=n.data,c=o.columns,q=a.getElementsByTagName("tbody")[0],g=q.childNodes.length-1,m=f.length-g,e=0;for(;e<m;e++){var p="",h=document.createElement("tr"),d=0,l=c.length;h.className=(e%2===0)?"mt-grid-row-odd":"mt-grid-row-even";for(;d<l;d++){var b=c[d];if((!k.left&&!b.locked)||(k.left&&b.locked===true)){p+=['<td style="max-width: 60px;" class="mt-grid-body-td">','<div class="mt-grid-body-td-text">',"</div>","</td>"].join("")}}h.innerHTML=p;q.appendChild(h)}},updateRows:function(){var l=this,o=l.widget,a=l.el,n=o.store,f=n.data,d=o.columns;tbodyEl=a.getElementsByTagName("tbody")[0],i=1,iL=f.length+1;for(;i<iL;i++){var k=tbodyEl.childNodes[i],q=f[i-1].data,e=0,m=d.length,p=0;for(;e<m;e++){var c=d[e];if((!l.left&&!c.locked)){var b=k.childNodes[e-p],g=b.firstChild,h=c.index;g.innerHTML=q[h]}else{if(l.left&&c.locked===true){var b=k.childNodes[e-(e-p)],g=b.firstChild,h=c.index;g.innerHTML=q[h]}}if(c.locked){p++}}}}});Mt.Class("Mt.grid.Header",{extend:Mt.Observable,constructor:function(a){var b=this,a=a||{};Mt.apply(b,a);b.Super("constructor",arguments);b.init()},init:function(){var a=this;a.render();a.setHandlers()},setHandlers:function(){var b=this,a=b.widget;a.on("afterrender",b.onAfterRender,b)},render:function(){var h=this,j=h.widget,d=j.columns,g=j.el.getElementsByClassName(h.left?"mt-grid-left-side":"mt-grid-right-side")[0],a=document.createElement("div"),f="",e=0,b=d.length;for(;e<b;e++){var c=d[e];if((!h.left&&!c.locked)||(h.left&&c.locked===true)){f+=['<div style="width:50px;" class="mt-grid-header-cell">','<div class="mt-grid-header-cell-text">',c.title,"</div>","</div>"].join("")}}a.className="mt-grid-header";a.innerHTML=f;h.el=g.appendChild(a)},onAfterRender:function(){var a=this}});